{"ts":1351879290965,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"  dojo.require(\"esri.map\");\n  dojo.require(\"esri.dijit.Legend\");\n  dojo.require(\"esri.dijit.Scalebar\");\n  dojo.require(\"esri.arcgis.utils\");\n  dojo.require(\"esri.IdentityManager\");\n  dojo.require(\"dijit.dijit\"); // optimize: load dijit layer\n  dojo.require(\"dijit.layout.BorderContainer\");\n  dojo.require(\"dijit.layout.ContentPane\");\n  dojo.require(\"dijit.layout.StackContainer\");\n  dojo.require(\"esri.tasks.query\");\n  dojo.requireLocalization(\"esriTemplate\",\"template\");\n\n\n    var map, urlObject;\n\tvar mapChange = false;\n\tvar mapExtent;\n\tvar firstMap = false;\n\tvar mapsLoaded = 1;\n\tvar i18n;\n\n     function initMap() {\n      patchID();\n\n\t  i18n = dojo.i18n.getLocalization(\"esriTemplate\",\"template\");\n\n\t  dojo.byId('loadText').innerHTML = i18n.viewer.loading.message;\n\t  dojo.byId('syncHead').innerHTML = i18n.viewer.sync.head;\n\t  dojo.byId('scale').innerHTML = i18n.viewer.sync.scale;\n\t  dojo.byId('location').innerHTML = i18n.viewer.sync.location;\n\t  dojo.byId('legText').innerHTML = i18n.viewer.toggles.legend;\n\t  dojo.byId('desText').innerHTML = i18n.viewer.toggles.description;\n\n      if(configOptions.geometryserviceurl && location.protocol === \"https:\"){\n        configOptions.geometryserviceurl = configOptions.geometryserviceurl.replace('http:','https:');\n      }\n      esri.config.defaults.geometryService = new esri.tasks.GeometryService(configOptions.geometryserviceurl);\n\n\n\n      if(!configOptions.sharingurl){\n        configOptions.sharingurl = location.protocol + '//' + location.host + \"/sharing/content/items\";\n      }\n      esri.arcgis.utils.arcgisUrl = configOptions.sharingurl;\n\n      if(!configOptions.proxyurl){\n        configOptions.proxyurl = location.protocol + '//' + location.host + \"/sharing/proxy\";\n      }\n\n      esri.config.defaults.io.proxyUrl =  configOptions.proxyurl;\n\n      esri.config.defaults.io.alwaysUseProxy = false;\n\n      urlObject = esri.urlToObject(document.location.href);\n      urlObject.query = urlObject.query || {};\n\n\t  if(urlObject.query.title){\n        configOptions.title = urlObject.query.title;\n      }\n      if(urlObject.query.subtitle){\n        configOptions.title = urlObject.query.subtitle;\n      }\n      if(urlObject.query.webmap){\n        if (dojo.isArray(urlObject.query.webmap) == false){\n        \tconfigOptions.webmaps[0].id = urlObject.query.webmap;\n\t\t\tconfigOptions.webmaps[1].id = urlObject.query.webmap;\n\t\t  }\n\t\t  else{\n\t\t\tdojo.forEach(urlObject.query.webmap,function(webmap,i){\n\t\t\t  configOptions.webmaps[i] = {\"id\": webmap};\n\t\t\t});\n\t\t  }\n      }\n      if(urlObject.query.bingMapsKey){\n        configOptions.bingmapskey = urlObject.query.bingMapsKey;\n      }\n\n \t  initMaps();\n\t  bannerSetup();\n\n      }\n\n\n    function createMap(j){\n\n\t  esriConfig.defaults.map.slider = { left:200 };\n\n\n      var mapDeferred = esri.arcgis.utils.createMap(configOptions.webmaps[j].id, \"mapDiv\"+[j], {\n        mapOptions: {\n          slider: true,\n          nav: false,\n          wrapAround180: true,\n\t\t  extent: mapExtent\n        },\n        ignorePopups:false,\n        bingMapsKey: configOptions.bingmapskey\n      });\n\n      mapDeferred.addCallback(function (response) {\n\n\t\tdojo.byId(\"title\"+[j]).innerHTML = response.itemInfo.item.title;\n        dojo.byId(\"description\"+[j]).innerHTML = response.itemInfo.item.description;\n\n        eval(\"map\"+[j]+\" = response.map\");\n\n\t\tdojo.connect(eval(\"map\"+[j]),\"onUpdateEnd\",hideLoader);\n\t\tdojo.connect(eval(\"map\"+[j]),\"onExtentChange\",syncMaps);\n\t\tdojo.connect(eval(\"map\"+[j]),\"onPanEnd\",enableSyncing);\n\t\tdojo.connect(eval(\"map\"+[j]),\"onZoomEnd\",enableSyncing);\n\n        var layers = response.itemInfo.itemData.operationalLayers;\n        if(eval(\"map\"+[j]).loaded){\n          initUI(layers,j);\n\t\t  $(\".esriSimpleSlider\").css(\"left\",($(\".map\").width()-42));\n\t\t  $(\"#mapDiv1_zoom_slider\").css(\"left\",($(\"#mapDiv1\").width()-42));\n        }\n        else{\n          dojo.connect(eval(\"map\"+[j]),\"onLoad\",function(){\n            initUI(layers,j);\n\t\t\t$(\".esriSimpleSlider\").css(\"left\",($(\".map\").width()-42));\n\t\t\t$(\"#mapDiv1_zoom_slider\").css(\"left\",($(\"#mapDiv1\").width()-42));\n          });\n        }\n       });\n\n      mapDeferred.addErrback(function (error) {\n          alert(i18n.viewer.errors.createMap + \" \" + dojo.toJson(error.message));\n      });\n\n\n\n    }\n\n    function initUI(layers,j) {\n      //add chrome theme for popup\n      dojo.addClass(eval(\"map\"+[j]).infoWindow.domNode, \"chrome\");\n      //add the scalebar\n\t  /*\n      var scalebar = new esri.dijit.Scalebar({\n        map: eval(\"map\"+[j]),\n        scalebarUnit:i18n.viewer.main.scaleBarUnits //metric or english\n      });\n\t  */\n      var layerInfo = buildLayersList(layers);\n\n      if(layerInfo.length > 0){\n        var legendDijit = new esri.dijit.Legend({\n          map:eval(\"map\"+[j]),\n          layerInfos:layerInfo\n        },'legend'+[j]);\n        legendDijit.startup();\n      }\n      else{\n        dojo.byId('legend'+[j]).innerHTML = 'No Legend';\n      }\n\n    }\n//build a list of layers to dispaly in the legend\n  function buildLayersList(layers){\n\n //layers  arg is  response.itemInfo.itemData.operationalLayers;\n  var layerInfos = [];\n  dojo.forEach(layers, function (mapLayer, index) {\n      var layerInfo = {};\n      if (mapLayer.featureCollection && mapLayer.type !== \"CSV\") {\n        if (mapLayer.featureCollection.showLegend === true) {\n            dojo.forEach(mapLayer.featureCollection.layers, function (fcMapLayer) {\n              if (fcMapLayer.showLegend !== false) {\n                  layerInfo = {\n                      \"layer\": fcMapLayer.layerObject,\n                      \"title\": mapLayer.title,\n                      \"defaultSymbol\": false\n                  };\n                  if (mapLayer.featureCollection.layers.length > 1) {\n                      layerInfo.title += \" - \" + fcMapLayer.layerDefinition.name;\n                  }\n                  layerInfos.push(layerInfo);\n              }\n            });\n          }\n      } else if (mapLayer.showLegend !== false && mapLayer.layerObject) {\n      var showDefaultSymbol = false;\n      if (mapLayer.layerObject.version < 10.1 && (mapLayer.layerObject instanceof esri.layers.ArcGISDynamicMapServiceLayer || mapLayer.layerObject instanceof esri.layers.ArcGISTiledMapServiceLayer)) {\n        showDefaultSymbol = true;\n      }\n      layerInfo = {\n        \"layer\": mapLayer.layerObject,\n        \"title\": mapLayer.title,\n        \"defaultSymbol\": showDefaultSymbol\n      };\n        //does it have layers too? If so check to see if showLegend is false\n        if (mapLayer.layers) {\n            var hideLayers = dojo.map(dojo.filter(mapLayer.layers, function (lyr) {\n                return (lyr.showLegend === false);\n            }), function (lyr) {\n                return lyr.id;\n            });\n            if (hideLayers.length) {\n                layerInfo.hideLayers = hideLayers;\n            }\n        }\n        layerInfos.push(layerInfo);\n    }\n  });\n  return layerInfos;\n  }\n\n\n     function patchID() {  //patch id manager for use in apps.arcgis.com\n       esri.id._isIdProvider = function(server, resource) {\n       // server and resource are assumed one of portal domains\n\n       var i = -1, j = -1;\n\n       dojo.forEach(this._gwDomains, function(domain, idx) {\n         if (i === -1 && domain.regex.test(server)) {\n           i = idx;\n         }\n         if (j === -1 && domain.regex.test(resource)) {\n           j = idx;\n         }\n       });\n\n       var retVal = false;\n\n       if (i > -1 && j > -1) {\n         if (i === 0 || i === 4) {\n           if (j === 0 || j === 4) {\n             retVal = true;\n           }\n         }\n         else if (i === 1) {\n           if (j === 1 || j === 2) {\n             retVal = true;\n           }\n         }\n         else if (i === 2) {\n           if (j === 2) {\n             retVal = true;\n           }\n         }\n         else if (i === 3) {\n           if (j === 3) {\n             retVal = true;\n           }\n         }\n       }\n\n       return retVal;\n     };\n    }\n\n\tfunction setExtent(){\n\t\tif (configOptions.syncMaps == true){\n\t\t\tif (firstMap == false){\n\t\t\t\tmapExtent = map0.extent();\n\t\t\t\tfirstMap = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction hideLoader(){\n\t\tif (mapsLoaded == configOptions.webmaps.length){\n\t\t\t$(\"#loadingCon\").hide();\n\t\t\tif(configOptions.webmaps.length == 2){\n\t\t\t\t$(\"#mapDiv1_zoom_slider\").show();\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tmapsLoaded++\n\t\t}\n\t\t$(\".esriSimpleSlider\").css(\"left\",($(\".map\").width()-42));\n\t\t$(\"#mapDiv1_zoom_slider\").css(\"left\",($(\"#mapDiv1\").width()-42));\n\t}\n\n\tfunction resizeMaps(){\n\t\tif(map0 != null){\n\t\t\tmap0.resize();\n\t\t}\n\t\tif(map1 != null){\n\t\t\tmap1.resize();\n\t\t}\n\t\tif(map2 != null){\n\t\t\tmap2.resize();\n\t\t}\n\t}\n\n\t$(window).resize(function(e) {\n\t\tresizeMaps();\n    });"]],"start1":0,"start2":0,"length1":0,"length2":8658}]],"length":8658}
{"contributors":[],"silentsave":true,"ts":1351879591657,"patch":[[{"diffs":[[0,"show();\n"],[1,"                \n"],[0,"\t\t\t}\n\t\t}"]],"start1":8271,"start2":8271,"length1":16,"length2":33}]],"length":8675,"saved":false}
{"ts":1351879593344,"patch":[[{"diffs":[[0,"        "],[1,"s"],[0,"\n\t\t\t}\n\t\t"]],"start1":8287,"start2":8287,"length1":16,"length2":17}]],"length":8676,"saved":false}
{"ts":1351879594270,"patch":[[{"diffs":[[0,"       s"],[1,"y"],[0,"\n\t\t\t}\n\t\t"]],"start1":8288,"start2":8288,"length1":16,"length2":17}]],"length":8677,"saved":false}
{"ts":1351879595493,"patch":[[{"diffs":[[0,"      sy"],[1,"ncMaps"],[0,"\n\t\t\t}\n\t\t"]],"start1":8289,"start2":8289,"length1":16,"length2":22}]],"length":8683,"saved":false}
{"ts":1351879596771,"patch":[[{"diffs":[[0,"syncMaps"],[1,"()"],[0,"\n\t\t\t}\n\t\t"]],"start1":8295,"start2":8295,"length1":16,"length2":18}]],"length":8685,"saved":false}
{"ts":1351879598117,"patch":[[{"diffs":[[0,"ncMaps()"],[1,";"],[0,"\n\t\t\t}\n\t\t"]],"start1":8297,"start2":8297,"length1":16,"length2":17}]],"length":8686,"saved":false}
{"ts":1351879602442,"patch":[[{"diffs":[[0,"    "],[-1,"    syncMaps();"],[0,"\n\t\t\t"]],"start1":8287,"start2":8287,"length1":23,"length2":8}]],"length":8671,"saved":false}
{"ts":1351879603863,"patch":[[{"diffs":[[0,"();\n"],[-1,"            \n"],[0,"\t\t\t}"]],"start1":8275,"start2":8275,"length1":21,"length2":8}]],"length":8658,"saved":false}
{"ts":1351879606590,"patch":[[{"diffs":[[0,"hide();\n"],[1,"            syncMaps();\n"],[0,"\t\t\tif(co"]],"start1":8191,"start2":8191,"length1":16,"length2":40}]],"length":8682,"saved":false}
{"ts":1351879669224,"patch":[[{"diffs":[[0,"Loaded++"],[1,";"],[0,"\n\t\t}\n\t\t$"]],"start1":8327,"start2":8327,"length1":16,"length2":17}]],"length":8683,"saved":false}
{"ts":1351879760628,"patch":[[{"diffs":[[0,"\n    var"],[-1," map"],[0,", urlObj"]],"start1":473,"start2":473,"length1":20,"length2":16}]],"length":8679,"saved":false}
{"ts":1351879761677,"patch":[[{"diffs":[[0,"\n    var"],[-1,","],[0," urlObje"]],"start1":473,"start2":473,"length1":17,"length2":16}]],"length":8678,"saved":false}
{"contributors":[],"silentsave":true,"ts":1352219821264,"patch":[[{"diffs":[[0,"bmap;\n\t\t"],[-1,"  "],[0,"}\n\t\t  el"]],"start1":2362,"start2":2362,"length1":18,"length2":16}]],"length":8676,"saved":false}
{"ts":1352219824134,"patch":[[{"diffs":[[0,"        "],[-1,"\t"],[1,"    "],[0,"configOp"]],"start1":2248,"start2":2248,"length1":17,"length2":20}]],"length":8679,"saved":false}
{"ts":1352219826604,"patch":[[{"diffs":[[0,"ap;\n\t\t}\n"],[-1,"\t\t"],[1,"      "],[0,"  else{\n"]],"start1":2367,"start2":2367,"length1":18,"length2":22}]],"length":8683,"saved":false}
{"ts":1352219829297,"patch":[[{"diffs":[[0,"webmap){"],[1,"if (dojo.isArray(urlObject.query.webmap) == false && getWebMaps(urlObject.query.webmap).length > 1){\n            configOptions.webmaps = getWebMaps(urlObject.query.webmap);"],[0,"\n       "]],"start1":2179,"start2":2179,"length1":16,"length2":188}]],"length":8855,"saved":false}
{"ts":1352219830915,"patch":[[{"diffs":[[0,"webmap){"],[1,"\n          "],[0,"if (dojo"]],"start1":2179,"start2":2179,"length1":16,"length2":27}]],"length":8866,"saved":false}
{"ts":1352219831935,"patch":[[{"diffs":[[0,"p){\n        "],[-1,"  "],[0,"if (dojo.isA"]],"start1":2184,"start2":2184,"length1":26,"length2":24}]],"length":8864,"saved":false}
{"ts":1352219835489,"patch":[[{"diffs":[[0,"ebmap);\n"],[1,"        }\n"],[0,"        "]],"start1":2361,"start2":2361,"length1":16,"length2":26}]],"length":8874,"saved":false}
{"ts":1352219839311,"patch":[[{"diffs":[[0,"      }\n        "],[1,"else "],[0,"if (dojo.isArray"]],"start1":2371,"start2":2371,"length1":32,"length2":37}]],"length":8879,"saved":false}
{"ts":1352219862244,"patch":[[{"diffs":[[0,"s();\n    });"],[1,"\n    \n    function getWebMaps(webmaps) {\n      if (webmaps.indexOf(',') !== -1) {\n\t\tvar mapIds = webmaps.split(',');\n\t\twebmapresults = dojo.map(mapIds, function (mapId) {\n\t\t  return {\n\t\t\tid: mapId\n\t\t  };\n\t\t});\n\t  } else {\n\t\tvar previewWebMap = {\n\t\t  id: webmaps\n\t\t};\n\t\twebmapresults = [previewWebMap, previewWebMap, previewWebMap];\n\t  }\n\t  \n\t  if (webmapresults.length < 2){\n\t\t  webmapresults[1] = webmapresults[0];\n\t  }\n\t  \n\t  return webmapresults;\n\t}"]],"start1":8867,"start2":8867,"length1":12,"length2":464}]],"length":9331,"saved":false}
{"ts":1352219862743,"patch":[[{"diffs":[[0,"    });\n"],[-1,"    "],[0,"\n    fun"]],"start1":8872,"start2":8872,"length1":20,"length2":16},{"diffs":[[0,"bMap];\n\t  }\n"],[-1,"\t  "],[0,"\n\t  if (webm"]],"start1":9200,"start2":9200,"length1":27,"length2":24},{"diffs":[[0,"];\n\t  }\n"],[-1,"\t  "],[0,"\n\t  retu"]],"start1":9285,"start2":9285,"length1":19,"length2":16}]],"length":9321,"saved":false}
