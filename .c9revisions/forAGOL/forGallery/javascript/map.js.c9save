{"ts":1351879382319,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"  dojo.require(\"esri.map\");\n  dojo.require(\"esri.dijit.Legend\");\n  dojo.require(\"esri.dijit.Scalebar\");\n  dojo.require(\"esri.arcgis.utils\");\n  dojo.require(\"esri.IdentityManager\");\n  dojo.require(\"dijit.dijit\"); // optimize: load dijit layer\n  dojo.require(\"dijit.layout.BorderContainer\");\n  dojo.require(\"dijit.layout.ContentPane\");\n  dojo.require(\"dijit.layout.StackContainer\");\n  dojo.require(\"esri.tasks.query\");\n  dojo.requireLocalization(\"esriTemplate\",\"template\");\n  \n  \n    var map, urlObject;\n\tvar mapChange = false;\n\tvar mapExtent;\n\tvar firstMap = false;\n\tvar mapsLoaded = 1;\n\tvar i18n;\n\t \n     function initMap() {\n      patchID();\n      \n\t  i18n = dojo.i18n.getLocalization(\"esriTemplate\",\"template\");\n\t  \n\t  dojo.byId('loadText').innerHTML = i18n.viewer.loading.message;\n\t  dojo.byId('syncHead').innerHTML = i18n.viewer.sync.head;\n\t  dojo.byId('scale').innerHTML = i18n.viewer.sync.scale;\n\t  dojo.byId('location').innerHTML = i18n.viewer.sync.location;\n\t  dojo.byId('legText').innerHTML = i18n.viewer.toggles.legend;\n\t  dojo.byId('desText').innerHTML = i18n.viewer.toggles.description;\n\t  \n      if(configOptions.geometryserviceurl && location.protocol === \"https:\"){\n        configOptions.geometryserviceurl = configOptions.geometryserviceurl.replace('http:','https:');\n      }\n      esri.config.defaults.geometryService = new esri.tasks.GeometryService(configOptions.geometryserviceurl);  \n      \n\n\n      if(!configOptions.sharingurl){\n        configOptions.sharingurl = location.protocol + '//' + location.host + \"/sharing/content/items\";\n      }\n      esri.arcgis.utils.arcgisUrl = configOptions.sharingurl;\n       \n      if(!configOptions.proxyurl){   \n        configOptions.proxyurl = location.protocol + '//' + location.host + \"/sharing/proxy\";\n      }\n\n      esri.config.defaults.io.proxyUrl =  configOptions.proxyurl;\n\n      esri.config.defaults.io.alwaysUseProxy = false;\n      \n      urlObject = esri.urlToObject(document.location.href);\n      urlObject.query = urlObject.query || {};\n\t  \n\t  if(urlObject.query.title){\n        configOptions.title = urlObject.query.title;\n      }\n      if(urlObject.query.subtitle){\n        configOptions.title = urlObject.query.subtitle;\n      }\n      if(urlObject.query.webmap){\n        if (dojo.isArray(urlObject.query.webmap) == false){\n        \tconfigOptions.webmaps[0].id = urlObject.query.webmap;\n\t\t\tconfigOptions.webmaps[1].id = urlObject.query.webmap;\n\t\t  }\n\t\t  else{\n\t\t\tdojo.forEach(urlObject.query.webmap,function(webmap,i){\n\t\t\t  configOptions.webmaps[i] = {\"id\": webmap};\n\t\t\t});\n\t\t  }\n      } \n      if(urlObject.query.bingMapsKey){\n        configOptions.bingmapskey = urlObject.query.bingMapsKey;      \n      }\n\t  \n\t  //is an appid specified - if so read json from there\n\t  if(configOptions.appid || (urlObject.query && urlObject.query.appid)){\n\t\tvar appid = configOptions.appid || urlObject.query.appid;\n\t\tvar requestHandle = esri.request({\n\t\t  url: configOptions.sharingurl + \"/\" + appid + \"/data\",\n\t\t  content: {f:\"json\"},\n\t\t  callbackParamName:\"callback\",\n\t\t  load: function(response){\n\t\t\t   if(response.values.title !== undefined){configOptions.title = response.values.title;}\n\t\t\t   if(response.values.subtitle !== undefined){configOptions.subtitle = response.values.subtitle;}\n\t\t\t   if(response.values.description !== undefined){configOptions.description = response.values.description; }\n\t\t\t   if(response.values.legend !== undefined) {configOptions.legend = response.values.legend;}\n\t\t\t   if(response.values.webmaps !== undefined) {configOptions.webmaps = getWebMaps(response.values.webmaps);}\n    \n\t\t\t   initMaps();\n\t  \t\t   bannerSetup();\n\t\t  },\n\t\t  error: function(response){\n\t\t\tvar e = response.message;\n\t\t   alert(i18n.viewer.errors.createMap +  response.message);\n\t\t  }\n\t\t});\n\t\t }else{\n\t\t\tinitMaps();\n\t \t\tbannerSetup();\n\t\t }\n\t  \n      }\n    \n    \n    function createMap(j){\n\t  \n\t  esriConfig.defaults.map.slider = { left:200 };\n\n\n      var mapDeferred = esri.arcgis.utils.createMap(configOptions.webmaps[j].id, \"mapDiv\"+[j], {\n        mapOptions: {\n          slider: true,\n          nav: false,\n          wrapAround180: true,\n\t\t  extent: mapExtent\n        },\n        ignorePopups:false,\n        bingMapsKey: configOptions.bingmapskey\n      });\n\n      mapDeferred.addCallback(function (response) {\n\t\t  \n\t\tdojo.byId(\"title\"+[j]).innerHTML = response.itemInfo.item.title;\n        dojo.byId(\"description\"+[j]).innerHTML = response.itemInfo.item.description;\n        \n        eval(\"map\"+[j]+\" = response.map\");\n\n\t\tdojo.connect(eval(\"map\"+[j]),\"onUpdateEnd\",hideLoader);\n\t\tdojo.connect(eval(\"map\"+[j]),\"onExtentChange\",syncMaps);\n\t\tdojo.connect(eval(\"map\"+[j]),\"onPanEnd\",enableSyncing);\n\t\tdojo.connect(eval(\"map\"+[j]),\"onZoomEnd\",enableSyncing);\n\t\t\n        var layers = response.itemInfo.itemData.operationalLayers;\n        if(eval(\"map\"+[j]).loaded){\n          initUI(layers,j);\n\t\t  $(\".esriSimpleSlider\").css(\"left\",($(\".map\").width()-42));\n\t\t  $(\"#mapDiv1_zoom_slider\").css(\"left\",($(\"#mapDiv1\").width()-42));\n        }\n        else{\n          dojo.connect(eval(\"map\"+[j]),\"onLoad\",function(){\n            initUI(layers,j);\n\t\t\t$(\".esriSimpleSlider\").css(\"left\",($(\".map\").width()-42));\n\t\t\t$(\"#mapDiv1_zoom_slider\").css(\"left\",($(\"#mapDiv1\").width()-42));\n          });\n        }\n       });\n\n      mapDeferred.addErrback(function (error) {\n          alert(i18n.viewer.errors.createMap + \" \" + dojo.toJson(error.message));\n      });\n\n\n    \n    }\n\n    function initUI(layers,j) {\n      //add chrome theme for popup\n      dojo.addClass(eval(\"map\"+[j]).infoWindow.domNode, \"chrome\");\n      //add the scalebar \n\t  /*\n      var scalebar = new esri.dijit.Scalebar({\n        map: eval(\"map\"+[j]),\n        scalebarUnit:i18n.viewer.main.scaleBarUnits //metric or english\n      });\n\t  */\n      var layerInfo = buildLayersList(layers);      \n      \n      if(layerInfo.length > 0){\n        var legendDijit = new esri.dijit.Legend({\n          map:eval(\"map\"+[j]),\n          layerInfos:layerInfo\n        },'legend'+[j]);\n        legendDijit.startup();\n      }\n      else{\n        dojo.byId('legend'+[j]).innerHTML = 'No Legend';\n      }\n\t  \n    }\n//build a list of layers to dispaly in the legend\n  function buildLayersList(layers){\n\n //layers  arg is  response.itemInfo.itemData.operationalLayers;\n  var layerInfos = [];\n  dojo.forEach(layers, function (mapLayer, index) {\n      var layerInfo = {};\n      if (mapLayer.featureCollection && mapLayer.type !== \"CSV\") {\n        if (mapLayer.featureCollection.showLegend === true) {\n            dojo.forEach(mapLayer.featureCollection.layers, function (fcMapLayer) {\n              if (fcMapLayer.showLegend !== false) {\n                  layerInfo = {\n                      \"layer\": fcMapLayer.layerObject,\n                      \"title\": mapLayer.title,\n                      \"defaultSymbol\": false\n                  };\n                  if (mapLayer.featureCollection.layers.length > 1) {\n                      layerInfo.title += \" - \" + fcMapLayer.layerDefinition.name;\n                  }\n                  layerInfos.push(layerInfo);\n              }\n            });\n          }\n      } else if (mapLayer.showLegend !== false && mapLayer.layerObject) {\n      var showDefaultSymbol = false;\n      if (mapLayer.layerObject.version < 10.1 && (mapLayer.layerObject instanceof esri.layers.ArcGISDynamicMapServiceLayer || mapLayer.layerObject instanceof esri.layers.ArcGISTiledMapServiceLayer)) {\n        showDefaultSymbol = true;\n      }\n      layerInfo = {\n        \"layer\": mapLayer.layerObject,\n        \"title\": mapLayer.title,\n        \"defaultSymbol\": showDefaultSymbol\n      };\n        //does it have layers too? If so check to see if showLegend is false\n        if (mapLayer.layers) {\n            var hideLayers = dojo.map(dojo.filter(mapLayer.layers, function (lyr) {\n                return (lyr.showLegend === false);\n            }), function (lyr) {\n                return lyr.id;\n            });\n            if (hideLayers.length) {\n                layerInfo.hideLayers = hideLayers;\n            }\n        }\n        layerInfos.push(layerInfo);\n    }\n  });\n  return layerInfos;\n  }\n    \n     function patchID() {  //patch id manager for use in apps.arcgis.com\n       esri.id._isIdProvider = function(server, resource) {\n       // server and resource are assumed one of portal domains\n \n       var i = -1, j = -1;\n \n       dojo.forEach(this._gwDomains, function(domain, idx) {\n         if (i === -1 && domain.regex.test(server)) {\n           i = idx;\n         }\n         if (j === -1 && domain.regex.test(resource)) {\n           j = idx;\n         }\n       });\n \n       var retVal = false;\n   \n       if (i > -1 && j > -1) {\n         if (i === 0 || i === 4) {\n           if (j === 0 || j === 4) {\n             retVal = true;\n           }\n         }\n         else if (i === 1) {\n           if (j === 1 || j === 2) {\n             retVal = true;\n           }\n         }\n         else if (i === 2) {\n           if (j === 2) {\n             retVal = true;\n           }\n         }\n         else if (i === 3) {\n           if (j === 3) {\n             retVal = true;\n           }\n         }\n       }\n \n       return retVal;\n     };    \n    }\n\t\n\tfunction setExtent(){\n\t\tif (configOptions.syncMaps == true){\n\t\t\tif (firstMap == false){\n\t\t\t\tmapExtent = map0.extent();\n\t\t\t\tfirstMap = true;\n\t\t\t}\n\t\t}\n\t}\n\t\n\tfunction hideLoader(){\n\t\tif (mapsLoaded == configOptions.webmaps.length){\n\t\t\t$(\"#loadingCon\").hide();\n\t\t\tif(configOptions.webmaps.length == 2){\n\t\t\t\t$(\"#mapDiv1_zoom_slider\").show();\n\t\t\t}\n\t\t}\n\t\telse{\n\t\t\tmapsLoaded++\n\t\t}\n\t\t$(\".esriSimpleSlider\").css(\"left\",($(\".map\").width()-42));\n\t\t$(\"#mapDiv1_zoom_slider\").css(\"left\",($(\"#mapDiv1\").width()-42));\n\t}\n\t\n\tfunction resizeMaps(){\n\t\tif(map0 != null){\n\t\t\tmap0.resize();\n\t\t}\n\t\tif(map1 != null){\n\t\t\tmap1.resize();\n\t\t}\n\t\tif(map2 != null){\n\t\t\tmap2.resize();\n\t\t}\n\t}\n\t\n\t$(window).resize(function(e) {\n\t\tresizeMaps();\n    });\n\t\n\tfunction getWebMaps(webmaps) {\n\t  if (webmaps.indexOf(',') !== -1) {\n\t\tvar mapIds = webmaps.split(',');\n\t\twebmapresults = dojo.map(mapIds, function (mapId) {\n\t\t  return {\n\t\t\tid: mapId\n\t\t  };\n\t\t});\n\t  } else {\n\t\tvar previewWebMap = {\n\t\t  id: webmaps\n\t\t};\n\t\twebmapresults = [previewWebMap, previewWebMap, previewWebMap];\n\t  }\n\t  \n\t  if (webmapresults.length < 2){\n\t\t  webmapresults[1] = webmapresults[0];\n\t  }\n\t  \n\t  return webmapresults;\n\t}"]],"start1":0,"start2":0,"length1":0,"length2":10310}]],"length":10310}
{"contributors":[],"silentsave":true,"ts":1351879685319,"patch":[[{"diffs":[[0,"hide();\n"],[1,"            \n            syncMaps();\n"],[0,"\t\t\tif(co"]],"start1":9398,"start2":9398,"length1":16,"length2":53}]],"length":10347,"saved":false}
{"ts":1351879686434,"patch":[[{"diffs":[[0,"();\n"],[-1,"            \n            syncMaps();\n"],[0,"\t\t\ti"]],"start1":9402,"start2":9402,"length1":45,"length2":8}]],"length":10310,"saved":false}
{"ts":1351879687296,"patch":[[{"diffs":[[0,"hide();\n"],[1,"            syncMaps();\n"],[0,"\t\t\tif(co"]],"start1":9398,"start2":9398,"length1":16,"length2":40}]],"length":10334,"saved":false}
{"ts":1351879749748,"patch":[[{"diffs":[[0,"    var "],[-1,"map,"],[0," urlObje"]],"start1":478,"start2":478,"length1":20,"length2":16}]],"length":10330,"saved":false}
{"ts":1351879751034,"patch":[[{"diffs":[[0,"    var "],[-1," "],[0,"urlObjec"]],"start1":478,"start2":478,"length1":17,"length2":16}]],"length":10329,"saved":false}
{"contributors":[],"silentsave":false,"ts":1352219893212,"patch":[[{"diffs":[[0,"alse"],[-1,"){\n        \t"],[1," && getWebMaps(urlObject.query.webmap).length > 1){\n            configOptions.webmaps = getWebMaps(urlObject.query.webmap);\n        }\n        else if (dojo.isArray(urlObject.query.webmap) == false){\n            "],[0,"conf"]],"start1":2286,"start2":2286,"length1":20,"length2":219},{"diffs":[[0,"webmap;\n"],[-1,"\t"],[1,"    "],[0,"\t\tconfig"]],"start1":2547,"start2":2547,"length1":17,"length2":20},{"diffs":[[0,"y.webmap;\n\t\t"],[-1,"  "],[0,"}\n\t\t  else{\n"]],"start1":2605,"start2":2605,"length1":26,"length2":24}]],"length":10529,"saved":false}
{"ts":1352220252722,"patch":[[{"diffs":[[0,"late\");\n"],[-1,"  \n  "],[1,"\n"],[0,"\n    var"]],"start1":464,"start2":464,"length1":21,"length2":17},{"diffs":[[0,"8n;\n"],[-1,"\t "],[0,"\n"],[1,""],[0,"    "]],"start1":584,"start2":584,"length1":11,"length2":9},{"diffs":[[0,"chID();\n"],[-1,"      "],[0,"\n"],[1,""],[0,"\t  i18n "]],"start1":624,"start2":624,"length1":23,"length2":17},{"diffs":[[0,"late\");\n"],[-1,"\t  "],[0,"\n"],[1,""],[0,"\t  dojo."]],"start1":689,"start2":689,"length1":20,"length2":17},{"diffs":[[0,"iption;\n"],[-1,"\t  "],[0,"\n"],[1,""],[0,"      if"]],"start1":1071,"start2":1071,"length1":20,"length2":17},{"diffs":[[0,"iceurl);"],[-1,"  \n      "],[1,"\n"],[0,"\n\n\n     "]],"start1":1371,"start2":1371,"length1":25,"length2":17},{"diffs":[[0,"ingurl;\n"],[-1,"       "],[0,"\n      i"]],"start1":1586,"start2":1586,"length1":23,"length2":16},{"diffs":[[0,"oxyurl){"],[-1,"   "],[0,"\n       "]],"start1":1621,"start2":1621,"length1":19,"length2":16},{"diffs":[[0," false;\n"],[-1,"      "],[0,"\n"],[1,""],[0,"      ur"]],"start1":1846,"start2":1846,"length1":23,"length2":17},{"diffs":[[0," || {};\n"],[-1,"\t  "],[0,"\n"],[1,""],[0,"\t  if(ur"]],"start1":1954,"start2":1954,"length1":20,"length2":17},{"diffs":[[0,"ect.query.webmap"],[1,"s"],[0,") == false && ge"]],"start1":2219,"start2":2219,"length1":32,"length2":33},{"diffs":[[0,"y.webmap"],[1,"s"],[0,").length"]],"start1":2275,"start2":2275,"length1":16,"length2":17},{"diffs":[[0,"y.webmap"],[1,"s"],[0,");\n     "]],"start1":2360,"start2":2360,"length1":16,"length2":17},{"diffs":[[0,"\n      }"],[-1," "],[0,"\n      i"]],"start1":2706,"start2":2706,"length1":17,"length2":16},{"diffs":[[0,"MapsKey;"],[-1,"      "],[0,"\n      }"]],"start1":2810,"start2":2810,"length1":22,"length2":16},{"diffs":[[0,"      }\n"],[-1,"\t  "],[0,"\n"],[1,""],[0,"\t  //is "]],"start1":2819,"start2":2819,"length1":20,"length2":17},{"diffs":[[0,"maps);}\n"],[-1,"    "],[0,"\n"],[1,""],[0,"\t\t\t   in"]],"start1":3706,"start2":3706,"length1":21,"length2":17},{"diffs":[[0,"\t }\n"],[-1,"\t  "],[0,"\n"],[1,""],[0,"      }\n"],[-1,"    \n    "],[1,"\n"],[0,"\n   "]],"start1":3942,"start2":3942,"length1":29,"length2":18},{"diffs":[[0,"Map(j){\n"],[-1,"\t  "],[0,"\n"],[1,""],[0,"\t  esriC"]],"start1":3976,"start2":3976,"length1":20,"length2":17},{"diffs":[[0,") {\n"],[-1,"\t\t  "],[0,"\n"],[1,""],[0,"\t\tdo"]],"start1":4400,"start2":4400,"length1":13,"length2":9},{"diffs":[[0,"on;\n"],[-1,"        "],[0,"\n"],[1,""],[0,"    "]],"start1":4553,"start2":4553,"length1":17,"length2":9},{"diffs":[[0,"g);\n"],[-1,"\t\t"],[0,"\n"],[1,""],[0,"    "]],"start1":4832,"start2":4832,"length1":11,"length2":9},{"diffs":[[0,"  });\n\n\n"],[-1,"    "],[0,"\n"],[1,""],[0,"    }\n\n "]],"start1":5516,"start2":5516,"length1":21,"length2":17},{"diffs":[[0,"scalebar"],[-1," "],[0,"\n\t  /*\n "]],"start1":5682,"start2":5682,"length1":17,"length2":16},{"diffs":[[0,"layers);"],[-1,"      \n      "],[1,"\n"],[0,"\n      i"]],"start1":5900,"start2":5900,"length1":29,"length2":17},{"diffs":[[0,"      }\n"],[-1,"\t  "],[0,"\n"],[1,""],[0,"    }\n//"]],"start1":6187,"start2":6187,"length1":20,"length2":17},{"diffs":[[0,"os;\n  }\n"],[-1,"    "],[0,"\n"],[1,""],[0,"     fun"]],"start1":8181,"start2":8181,"length1":21,"length2":17},{"diffs":[[0,"domains\n"],[-1," "],[0,"\n"],[1,""],[0,"       v"]],"start1":8379,"start2":8379,"length1":18,"length2":17},{"diffs":[[0,"j = -1;\n"],[-1," "],[0,"\n"],[1,""],[0,"       d"]],"start1":8407,"start2":8407,"length1":18,"length2":17},{"diffs":[[0,"    });\n"],[-1," "],[0,"\n"],[1,""],[0,"       v"]],"start1":8652,"start2":8652,"length1":18,"length2":17},{"diffs":[[0," false;\n"],[-1,"   "],[0,"\n"],[1,""],[0,"       i"]],"start1":8680,"start2":8680,"length1":20,"length2":17},{"diffs":[[0,"      }\n"],[-1," "],[0,"\n"],[1,""],[0,"       r"]],"start1":9177,"start2":9177,"length1":18,"length2":17},{"diffs":[[0,"  };"],[-1,"    "],[0,"\n    }\n"],[-1,"\t"],[0,"\n"],[1,""],[0,"\tfun"]],"start1":9211,"start2":9211,"length1":21,"length2":16},{"diffs":[[0,"\t\t\t}\n\t\t}\n\t}\n"],[-1,"\t"],[0,"\n"],[1,""],[0,"\tfunction hi"]],"start1":9364,"start2":9364,"length1":26,"length2":25},{"diffs":[[0,"2));\n\t}\n"],[-1,"\t"],[0,"\n"],[1,""],[0,"\tfunctio"]],"start1":9745,"start2":9745,"length1":18,"length2":17},{"diffs":[[0,"\n\t\t}\n\t}\n"],[-1,"\t"],[0,"\n"],[1,""],[0,"\t$(windo"]],"start1":9899,"start2":9899,"length1":18,"length2":17},{"diffs":[[0,"});\n"],[-1,"\t"],[0,"\n"],[1,""],[0,"\tfun"]],"start1":9960,"start2":9960,"length1":10,"length2":9},{"diffs":[[0,"];\n\t  }\n"],[-1,"\t  "],[0,"\n"],[1,""],[0,"\t  if (w"]],"start1":10282,"start2":10282,"length1":20,"length2":17},{"diffs":[[0,"];\n\t  }\n"],[-1,"\t  "],[0,"\n\t  retu"]],"start1":10363,"start2":10363,"length1":19,"length2":16}]],"length":10399,"saved":false}
{"ts":1352220313288,"patch":[[{"diffs":[[0,"uery.subtitle){\n"],[1,"        configOptions.subtitle = urlObject.query.subtitle;\n      }\n      if(urlObject.query.description){\n        configOptions.description = urlObject.query.description;\n      }\n      if(urlObject.query.subtitle){\n"],[0,"        configOp"]],"start1":2074,"start2":2074,"length1":32,"length2":247}]],"length":10614,"saved":false}
{"ts":1352220326418,"patch":[[{"diffs":[[0,"bject.query."],[-1,"subtitle"],[1,"legend"],[0,"){\n        c"]],"start1":2282,"start2":2282,"length1":32,"length2":30},{"diffs":[[0,"  configOptions."],[-1,"title"],[1,"legend"],[0," = urlObject.que"]],"start1":2309,"start2":2309,"length1":37,"length2":38},{"diffs":[[0,"bject.query."],[-1,"subtitle"],[1,"legend"],[0,";\n      }\n  "]],"start1":2338,"start2":2338,"length1":32,"length2":30}]],"length":10611,"saved":false}
